!function(e,t){"use strict";function n(e){function t(e){if("INPUT"!==e.prop("tagName")||e.prop("type")&&"text"!==e.prop("type"))throw"This directive should be applied to input[type=text] element.";return n}function n(e,t,n,r){}var o={restrict:"A",controller:r,compile:t};return o}function r(e,n,r,o,u,i){function a(){return u.setSelection(n,h.$viewValue.start,h.$viewValue.end,h.$viewValue.dir),h}function l(e){return V(e,h.$viewValue)?h:(e||(e={}),f(h.$viewValue,e.start,e.end,e.dir),h)}function s(t){return t||(t={}),h.$modelValue||(h.$modelValue=m(e)),g&&V(g,h.$modelValue)?h:(f(h.$modelValue,t.start,t.end,t.dir),w(e,h.$modelValue),h)}function c(){var t,n=m(e);return v(n,h.$viewValue)?(f(n,n.pos,n.pos,!0),w(e,n),n):(h.$modelValue=n,t=h.$modelValue,h.$setViewValue(t).$render(),h.$modelValue.pos=h.$viewValue.pos,i.$$phase||e.$apply(),n)}function $(){S.forEach(function(e){n.on(e,p)})}function d(){S.forEach(function(e){n.off(e,p)})}function p(t){h.$viewValue=u.getSelection(n),y&&!i.$$phase&&e.$apply(function(){h.$setModelValue(h.$viewValue)})}function f(e,t,n,r){var o=Math.min(t,n),u=Math.max(t,n),i=r,a=i?u:o;return e.start=o,e.end=u,e.dir=i,e.pos=a,e}function V(e,t){if(!e||!t)return!1;var n=!0;return n=n&&e.start===t.start,n=n&&e.end===t.end,n=n&&e.dir===t.dir,n=n&&e.pos===t.pos}function v(e,t){if(!e||!t)return!1;var n=!0;return n=n&&e.start===t.start,n=n&&e.end===t.end,n=n&&e.dir===t.dir,n=n&&e.pos!==t.pos}var m,w,h=this,y=!!o[t];h.$setModelValue=s,h.$setViewValue=l,h.$viewValue=u.getSelection(n),h.$render=a,y&&(m=r(o[t]),w=m.assign,e.$watch(o[t],c,!0),h.$setModelValue({start:0,end:0,pos:0,dir:void 0}));var S=["click","keyup","keydown","keypress","mousedown","mouseup","focus","blur"];$(),e.$on("$destroy",d);var g}e.directive(t,n),n.$inject=["InputSelection"],r.$inject=["$scope","$element","$parse","$attrs","InputSelection","$rootScope"]}(angular.module("arth.cursor",["arth.svc.InputSelection"]),"arthCursor");
!function(e,r){"use strict";function t(){return{require:[r,"ngModel"],restrict:"A",controller:n}}function n(e,t,n,i,a,s,l,c,u){function p(e){function r(e){var r=d.toModel.parse(e||"");return r}function t(e){var r=$.toView.parse(e||"");return r.join("")}function n(e,r){function n(e){~i||(i=e)}if(r)return e.join("");var i=-1,o=m.length;e.forEach(function(e,r){var t=m[r];t!==e&&(r>=o?n(r+1,"New Token, set cursor after it"):e===m[r+1]?n(r,"Removed Token, set cursor before next"):n(r+1,"Inserted Token, set cursor after next"),m[r]=e)}),o>e.length&&(n(e.length,"Was truncated: set after last new token"),m.splice(e.length));var a=t(e.join(""));return g(e.join(""),i),a}var i=e.mvMap,a=o(i),l=e.regexp[0],u=e.regexp[1],p=e.commonExp,f=e.tpl[0],v=e.tpl[1];l.type="param_mapping",u.type="param_mapping",l.template=v,u.template=f,l.mapping=a,u.mapping=i,angular.isArray(p)||(p=[p]),l=[l].concat(p),u=[u].concat(p);var d=c.getRepeater(l,!0),$=c.getRepeater(u,!0);d.toModel=c.getMapping(l),$.toView=c.getMapping(u);var w=[r,n],y=[t];s.fillListProcesser(w,h.$parsers),s.fillListProcesser(w,P),s.fillListProcesser(y,h.$formatters),s.fillListProcesser(y,j)}function f(e){for(var r=j.length,t=e;r--;)t=j[r](t,!0);return t}function g(e,r){var t=f(e);console.log("updateView",h.$viewValue,t,h.$viewValue===t),t!==h.$viewValue&&(h.$setViewValue(t),h.$render(),v(r))}function v(e){if(~e&&"undefined"!=typeof e){var r=m.map(f).slice(0,e).join("").length;console.log("setPos",m.map(f).slice(0,e).join(""),e,r),a(function(){l.setSelection(t,r,r,!0),y=r})}}function d(r){var n=l.getSelection(t),i=m.map(f);"undefined"==typeof n.start&&(n.end=n.start=i.join("").length);for(var o=null,s=null,c=0,u=0,p=m.length;p>=c&&(u==n.start&&null===o||u>n.start&&null===o&&(o=c-1),u>=n.end&&null===s&&(s=c),c!=p);c++){var g=m[c];u+=f(g).length}null===o&&(o=s),m.splice(o,s-o,r),i.splice(o,s-o,r),$.assign(e,m.join("")),a(function(){var e=i.slice(0,o).join("").length+f(r).length;l.setSelection(t,e,e,!0)})}var h=t.controller("ngModel"),m=[],$=i(n.ngModel),w=i(n[r])(e),P=[],j=[];angular.extend(w,{addToken:d}),w.modelviews&&w.modelviews.forEach(p);var y=0}function i(){function e(e,n){return Array.isArray(e)?(e.forEach(r(n)),t):t}function r(e){function r(r){var o="push";if(Array.isArray(r)){if(o=r[i],!~["push","unshift"].indexOf(o))throw new Error(t.name+": Wrong method ["+o+"] - push|unshift expected");r=r[n]}e[o](r)}var n=0,i=1;return r}var t=this;t.$name="ParseFormatService",this.getListProcesser=r,this.fillListProcesser=e}function o(e){var r={};for(var t in e)e.hasOwnProperty(t)&&(r[e[t]]=t);return r}e.directive(r,t),e.service("ParseFormatService",i),t.$inject=[],n.$inject=["$scope","$element","$attrs","$parse","$timeout","ParseFormatService","InputSelection","ParserFactory","MappingParser"],i.$inject=[]}(angular.module("arth.tokenized",["arth.parser.svc"]),"arthTokenized");
!function(t){"use strict";function n(){function t(t){var o={start:n(t),end:e(t),dir:r(t)};return o.pos=o.dir?o.end:o.start,o}function n(t){return t[0].selectionStart}function e(t){return t[0].selectionEnd}function r(t){var n={none:void 0,forward:!0,backward:!1};return n[t[0].selectionDirection]}function o(t,n,e,r){n=n||0,e=e||0,t[0].setSelectionRange(Math.min(n,e),Math.max(n,e),"undefined"==typeof r?"none":r?"forward":"backward")}return{getSelection:t,getSelectionStart:n,getSelectionEnd:e,getSelectionDirection:r,setSelection:o}}t.factory("InputSelection",n)}(angular.module("arth.svc.InputSelection",[]));
!function(n){function e(n){var e=[],t=e[0]=[];return new n([",","\n"],function(n,e){e?("\n"==n||"\x00"==n)&&(this.tokens.push(t),t=[]):t.push(n)})}function t(n){function e(e){return new n(e,function(n,e,t,r){if("\x00"!=n&&e)switch(t.type){case"param_mapping":var i=t.mapping[r[1]];if("undefined"==typeof i)return;var u=t.subst||"{{VALUE}}";return t.template.replace(u,i);default:return n}})}return e}function r(){function n(n,e){this.tokenizers=Array.isArray(n)?n:[n],e&&(this.doBuild=e)}function e(e,t){function r(n,e){return"\x00"!==n?e?n:t?void 0:n:void 0}return new n(e,r)}function r(e,t){return function(r){function i(n,e,i){return"\x00"!==n?e?n.replace(i,function(n,e){return r[e]}):t?void 0:n:void 0}return new n(e,i)}}function i(e){return new(t(n))(e)}function u(n){this.src=n,this.ended=!1,this.tokens=[];do this.next();while(!this.ended);return this.tokens}function s(n,e,t){if(n){var r=this.doBuild?this.doBuild(n,e,this.tkn,t):n;"undefined"!=typeof r&&this.tokens.push(r)}}function c(){var n,e=this;e.search(),n=e.src.slice(0,e.min),e.build(n,!1),e.src=e.src.slice(e.min).replace(e.tkn,function(n){return e.build(n,!0,[].slice.call(arguments,0)),""}),e.src||(e.build("\x00",!0),e.ended=!0)}function o(){var n,e,t=this,r=0;for(t.min=-1,t.tkn="";"undefined"!=typeof(n=t.tokenizers[r++]);)e=t.src[n.test?"search":"indexOf"](n),-1!=e&&(-1==t.min||e<t.min)&&(t.tkn=n,t.min=e);-1==t.min&&(t.min=t.src.length)}return angular.extend(n.prototype,{parse:u,build:s,next:c,search:o}),n.getRepeater=e,n.getReplacer=r,n.getMapping=i,n}n.factory("ParserFactory",r),n.service("CSVParser",e),n.service("MappingParser",t),e.$inject=["ParserFactory"],t.$inject=["ParserFactory"],r.$inject=[]}(angular.module("arth.parser.svc",[]));